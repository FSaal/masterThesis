%\pagestyle{fancy}
\chapter{Experimental Setup}
\label{ch:ExperimentalSetup}

\section{Sensors}
\subsection{\glsentrytext{imu}}
\missingfigure{Picture of myAHRS+ or/and ZED2i}
\begin{tikzpicture}
    \coordinate (O) at (0,0,0);
    \draw[thick,->, red] (0,0,0) -- (1,0,0) node[anchor=north east]{$x$};
    \draw[thick,->, green] (0,0,0) -- (0,1,0) node[anchor=north west]{$y$};
    \draw[thick,->, blue] (0,0,0) -- (0,0,1) node[anchor=south]{$z$};
\end{tikzpicture}
For the experiments the myAHRS+, a low cost high performance \acrfull{ahrs} will be used.
An \acrshort{ahrs} contains an \acrshort{imu} and outputs the raw data but also has an integrated Kalman filter which calculates the pose in form of quaternion or euler angles.
It offers an micro-USB interface and runs with up to \SI{100}{\Hz}.
It can capture a change of $\pm$2000 dps (degrees per second), $\pm$16 $g$ and $\pm$\SI{1200}{\micro\tesla}.
During the experiment only a fraction of this range is expected to be reached, hence the sensor seems suitable.
Besides the hardware the unit already has an Extended Kalman Filter (EKF) on board.
The EKF fuses the measurements of the three sensors and estimates a quaternion (and sth else?) from it.
But this will not be used.
\itodo{Also add ZED 2i \acrshort{imu} and compare (probably table similar to \acrshort{lidar})}


\subsection{\glsentrytext{lidar}}
Two different \acrshort{lidar}s will be used during the experiment.
The RS-Bpearl and the Velodyne UltraPuck.
The most relevant specifications of the two \acrshort{lidar}s can be seen in table \ref{tab:lidar_datasheets}.
Both are mechanical \acrshort{lidar}s and have the same number of laser channels, but the Velodyne has a significant better vertical resolution, due to the smaller vertical \acrshort{fov}.
\begin{table}[ht]
	\centering
	% todo: Manual citation prop wrong
	\caption{Comparison of the two used \acrshort{lidar}s \cite{RoboSense2020}\cite{Rev}}
	\label{tab:lidar_datasheets}
	\begin{tabular}[t]{lcc}
	\toprule
	&\textbf{RS-Bpearl} & \textbf{Velodyne Ultra Puck}\\
	\midrule
	Channels 					& 32 							& 32\\
	Range 						& \SI{100}{\metre}				& \SI{200}{\metre}\\
	Range accuracy				& $\pm\SI{3}{\centi\metre}$		& $\pm\SI{3}{\centi\metre}$\\
	Horizontal \acrshort{fov}	& \SI{360}{\degree}				& \SI{360}{\degree}\\
	Vertical \acrshort{fov} 	& \SI{90}{\degree} 				& \SI{40}{\degree} (\SIrange{-25}{15}{\degree})\\
	Horizontal resolution		& \SIrange{0.2}{0.4}{\degree} 	& \SIrange{0.1}{0.4}{\degree}\\
	Vertical resolution			& \SI{2.81}{\degree} 			& \SI{0.33}{\degree}\\
	Frame rate 					& \SIrange{10}{20}{\hertz}		& \SIrange{5}{20}{\hertz}\\
	Laser wavelength 			& \SI{905}{\nano\metre} 		& \SI{903}{\nano\metre}\\
	% \midrule
	Points per second 			& 576,000						& 600,000		\\
	\bottomrule
	\end{tabular}
	\end{table}%
\missingfigure{Picture of robosense or/and velodyne}



\section{Sensor placement}
\begin{figure}[htpb]
	\centering
	\input{Graphics/TikZ/lidar_mount.tex}
	\caption{Mounting of the \acrshort{lidar}}
	\label{fig:tikz_lidar_mount}
\end{figure}
\itodo{\acrshort{imu} placement not really important, should just be static}
The \acrshort{lidar} will be placed on top of the car, to get a greater \acrshort{fov}.
The pitch angle at which the \acrshort{lidar} will be mounted should be chosen so that the number of points in the area at the beginning of the ramp are maximized.
This allows for an easier detection of planes with different inclination angles.
The coordinates at which the lasers hit the ground and ramp depend on the height of the \acrshort{lidar} $ h_\mathrm{L} $, the distance to the ramp $d$, the angle of the ramp $\alpha$, the pitch angle $\gamma$ at which the \acrshort{lidar} is mounted and finally on the vertical resolution and \acrshort{fov} of the \acrshort{lidar}. The coordinates can be calculated in the following way.\\
Assuming there is no ramp, the x-coordinate where the laser waves hit the ground can be calculated with
\begin{equation}
	x = \frac{h}{\tan(n\beta - \gamma)}
	\label{eq:ground_points}
\end{equation}
with $n$ being the "laserID" starting from the lowest opening angle and going to the highest.
When the ground is not a flat anymore, the assumption from \ref{eq:ground_points} does not hold anymore. The x distance between two laser points reduces on a ramp.
\dots whatever who cares
\itodo{Make a good sketch again with labels etc and check if its easy understandable, only then continue in tikz and latex}
\[ c = h - \frac{z}{\tan \alpha} \]
\itodo{\acrshort{lidar} pitch angle at which most point hit area before ramp can be calculated, explaination here using sketch \ref{fig:tikz_lidar_mount}}



\section{Car}
\missingfigure{Picture of eGolf}
\todoin{\begin{itemize}
	\item Some stats as height, track width etc, electric car hence less vibrations
	\item Problem with speed limit and odom (no odom when driving ramp up)
	\item Connection setup (maybe own section or maybe not interesting at all)
\end{itemize}
}



\section{Garage}
\missingfigure{Picture of ramps and/or figure of ramps showing angles}
\itodo{Think of a good way to measure the true angle of the ramps}